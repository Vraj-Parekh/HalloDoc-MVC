@model List<AdminDashboardDTO>

@{
    ViewData["Title"] = "AdminDashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var count = ViewBag.count;
}
@section style {
    <link rel="stylesheet" href="~/css/admin_dashboard.css" asp-append-version="true" />

}


<div class="tab-pane container-fluid active" id="dashboard">
    <div class="row justify-content-center mt-3">
        <div class="col-xl-2 col-sm-4 col-6">
            <div class="mt-1 p-3 rounded d-flex flex-column pointer" role="button" id="NewState" onclick="activateTab('NewState')">
                <span><i class="bi bi-compass"></i> NEW</span>
                <span class="h3 fw-bold">@count.NewCount </span>
            </div>
        </div>

        <div class="col-xl-2 col-sm-4 col-6">
            <div class="mt-1 p-3 rounded d-flex flex-column" role="button" id="PendingState" onclick="activateTab('PendingState')">
                <span><i class="bi bi-person"></i> PENDING</span>
                <span class="h3 fw-bold">@count.PendingCount</span>
            </div>
        </div>

        <div class="col-xl-2 col-sm-4 col-6">
            <div class="mt-1 p-3 rounded d-flex flex-column" role="button" id="ActiveState" onclick="activateTab('ActiveState')">
                <span><i class="bi bi-check2-circle"></i> ACTIVE</span>
                <span class="h3 fw-bold">@count.ActiveCount</span>
            </div>

        </div>

        <div class="col-xl-2 col-sm-4 col-6">
            <div class="mt-1 p-3 rounded d-flex flex-column" role="button" id="ConcludeState" onclick="activateTab('ConcludeState')">
                <span><i class="bi bi-clock"></i> CONCLUDE</span>
                <span class="h3 fw-bold">@count.ConcludeCount</span>
            </div>
        </div>

        <div class="col-xl-2 col-sm-4 col-6">
            <div class="mt-1 p-3 rounded d-flex flex-column" role="button" id="ToCloseState" onclick="activateTab('ToCloseState')">
                <span><i class="bi bi-person-x-fill"></i> TO CLOSE</span>
                <span class="h3 fw-bold">@count.ToCloseCount</span>
            </div>
        </div>

        <div class="col-xl-2 col-sm-4 col-6 ">
            <div class="mt-1 p-3 rounded d-flex flex-column" role="button" id="UnpaidState" onclick="activateTab('UnpaidState')">
                <span><i class="fa-solid fa-dollar-sign"></i> UNPAID</span>
                <span class="h3 fw-bold">@count.UnpaidCount</span>
            </div>
        </div>
    </div>


    <div class="row m-lg-2 ">
        <div class="d-flex justify-content-between m-2">
            <h3 class="p-2">Patients <span style="color:#00008b" id="spanText"></span></h3>
            <div class="p-2">
                <button type="button" class="btn btn-info fs-6 fw-semibold mx-1 p-2 text-white"><i class="fa-regular fa-paper-plane pe-1"></i><span class=""> Send Link</span></button>
                <button type="button" class="btn btn-info fs-6 fw-semibold mx-1 p-2 text-white"><i class="fa-solid fa-notes-medical pe-1"></i><span> Create Request</span></button>
                <button type="button" class="btn btn-info fs-6 fw-semibold mx-1 p-2 text-white"><i class="fa-solid fa-share pe-1"></i><span>Export</span></button>
                <button type="button" class="btn btn-info fs-6 fw-semibold mx-1 p-2 text-white"><i class="fa-solid fa-share pe-1"></i><span>Export All</span></button>
                <button type="button" class="btn btn-info fs-6 fw-semibold mx-1 p-2 text-white"><i class="fa-solid fa-headset pe-1"></i><span>Request DTY Support</span></button>
            </div>
        </div>
        <div class="row g-2 mt-2 pt-2 pb-2 bg-white shadow rounded-1">
            <div class="col-md-2 col-sm-12">
                <i class="bi bi-search text-muted position-absolute" style="padding-top: 5px; padding-left:9px;"></i>
                <input type="search" class="form-control" style="padding-left:35px;" id="search" placeholder="Search Patients">
            </div>

            <div class="col-md-2 col-sm-12">

                <i class="text-muted position-absolute" style="padding-top:10px; padding-left:10px;"></i>
                <select class="form-select" id="floatingSelectGrid">

                    <option selected>All Regions</option>
                    <option value="1">Ahmedabad</option>
                    <option value="2">Gandhinagar</option>
                    <option value="3">Surat</option>
                </select>
            </div>

            <div class="col-md-8 col-sm-12">
                <div class="text-end text-sm-start d-md-flex justify-content-md-end req-container">
                    <button class="btn btn-white me-2" id="AllFilter" onclick="activateFilter('AllFilter')">All</button>
                    <button class="btn btn-white me-2" type="button" id="PatientFilter" onclick="activateFilter('PatientFilter')"><i class="bi bi-circle-fill me-1 green-color"></i>Patient</button>
                    <button class="btn btn-white me-2" type="button" id="FamilyFilter" onclick="activateFilter('FamilyFilter')"><i class="bi bi-circle-fill me-1 orange-color"></i>Family</button>
                    <button class="btn btn-white me-2" type="button" id="BusinessFilter" onclick="activateFilter('BusinessFilter')"><i class="bi bi-circle-fill me-1 pink-color"></i>Business</button>
                    <button class="btn btn-white me-2" type="button" id="ConciergeFilter" onclick="activateFilter('ConciergeFilter')"><i class="bi bi-circle-fill me-1 blue-color"></i>Concierge</button>
                    <button class="btn btn-white me-2" type="button" id="VipFilter" onclick="activateFilter('VipFilter')"><i class="bi bi-circle-fill me-1 blue-color"></i>VIP</button>
                </div>
            </div>
        </div>
    </div>

    <div id="tableRecords" class="tableData mb-5"></div>
</div>

@section Scripts {
    <script>
        var requestTypeId = 5;//for all
        var status = 1;//new state
        var pageIndex = 1;
        var count = 10;
        var previousTab = null;
        var previousFilter = null;
        function activateTab(tabId) {
            // Deactivate previous tab
            if (previousTab !== null) {
                previousTab.classList.remove('active');
            }

            // Activate the clicked tab
            let clickedTab = document.getElementById(tabId);
            clickedTab.classList.add('active');
            var spanEle = document.getElementById('spanText');
            spanEle.textContent = "(" + tabId.substring(0, tabId.indexOf("State")) + ")";

            switch (tabId) {
                case "NewState":
                    status = 1;
                    getData();
                    break;
                case "PendingState":
                    status = 2;
                    getData();
                    break;
                case "ActiveState":
                    status = 3;
                    getData();
                    break;
                case "ConcludeState":
                    status = 4;
                    getData();
                    break;
                case "ToCloseState":
                    status = 5;
                    getData();
                    break;
                case "UnpaidState":
                    status = 6;
                    getData();
                    break;
            }


            // Update the previousTab variable
            previousTab = clickedTab;
        }

        function activateFilter(tabId) {
            // Deactivate previous tab
            if (previousFilter !== null) {
                previousFilter.classList.remove('box');
            }

            // Activate the clicked tab
            let clickedfilter = document.getElementById(tabId);
            clickedfilter.classList.add('box');

            switch (tabId) {
                case "AllFilter":
                    requestTypeId = 5;
                    getData();
                    break;
                case "PatientFilter":
                    requestTypeId = 2;
                    getData();
                    break;
                case "FamilyFilter":
                    requestTypeId = 3;
                    getData();
                    break;
                case "ConciergeFilter":
                    requestTypeId = 4;
                    getData();
                    break;
                case "BusinessFilter":
                    requestTypeId = 1;
                    getData();
                    break;
                case "VipFilter":
                    requestTypeId = 5;
                    getData();
                    break;
            }
            // Update the previousFilter
            previousFilter = clickedfilter;
        }
        activateTab('NewState');
        activateFilter('AllFilter');

        $(document).ready(function () {
            $('#NewState').trigger('click');
            $('#All').trigger('click');
        });

        function getData() {
            // alert(requestTypeId);
            $.ajax({
                url: '@Url.Action("Table", "Admin")',
                type: 'get',
                data: { status: status, requestTypeId: requestTypeId, pageIndex: pageIndex, count: count },
                success: function (result) {
                    // console.log(result);
                    if (result.includes('table')) 
                    { 
                        $(".tableData").html(result);
                    }
                    else
                    {
                        window.location.reload();
                    }
                }
            });
        }
    </script>
}